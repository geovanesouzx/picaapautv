<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineVerse - Explore Universos Cinematográficos</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --background: #0c0a09; --text-primary: #e5e7eb; --text-secondary: #9ca3af;
            --card-bg: #1f2937; --header-bg: rgba(12, 10, 9, 0.7);
            --overlay-bg: rgba(12, 10, 9, 0.95);
            --card-hover-bg: #374151; /* gray-700 */
            --accent-color: #a855f7; /* purple-500 */
            --hero-text-primary: #ffffff;
            --hero-text-secondary: #e5e7eb;
            --star-color: #facc15; /* yellow-400 */
        }
        html.light {
            --background: #f3f4f6; --text-primary: #1f2937; --text-secondary: #4b5563;
            --card-bg: #ffffff; --header-bg: rgba(255, 255, 255, 0.7);
            --overlay-bg: rgba(243, 244, 246, 0.95);
            --card-hover-bg: #e5e7eb; /* gray-200 */
            --accent-color: #8b5cf6; /* violet-500 */
            --hero-text-primary: #111827; /* gray-900 */
            --hero-text-secondary: #374151; /* gray-700 */
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        .hero-gradient-bottom { background-image: linear-gradient(to top, var(--background) 10%, rgba(12, 10, 9, 0) 100%); }
        .hero-gradient-left { background-image: linear-gradient(to right, var(--background) 20%, transparent 100%); }
        .carousel-container, .search-results { scrollbar-width: none; }
        .carousel-container::-webkit-scrollbar, .search-results::-webkit-scrollbar { display: none; }
        .modal { transition: opacity 0.3s, visibility 0.3s; visibility: hidden; opacity: 0; }
        .modal.active { visibility: visible; opacity: 1; }
        #mobile-nav, .mobile-overlay { transition: opacity 0.3s, visibility 0.3s; visibility: hidden; opacity: 0; }
        #mobile-nav.active, .mobile-overlay.active { visibility: visible; opacity: 1; }
        .hoverable-item:hover { background-color: var(--card-hover-bg); }
        .mobile-nav-item { color: var(--text-secondary); }
        .mobile-nav-item.active { color: var(--accent-color); }
        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;
        }
        .star-rating .lucide-star { cursor: pointer; transition: color 0.2s; }
    </style>
</head>
<body class="pb-20 md:pb-0">

    <!-- Cabeçalho (Desktop) -->
    <header class="fixed top-0 left-0 right-0 bg-opacity-70 backdrop-blur-md z-40" style="background-color: var(--header-bg);">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-8">
                    <a href="#" id="home-link" class="text-2xl font-bold"><span class="text-blue-500">Cine</span><span class="text-purple-500">Verse</span></a>
                </div>
                <div class="hidden lg:flex items-center space-x-4">
                     <button id="desktop-search-button" class="p-2 rounded-md hoverable-item"><i data-lucide="search"></i></button>
                     <button id="desktop-movies-button" class="text-sm font-medium p-2 rounded-md hoverable-item">Filmes</button>
                     <button id="desktop-series-button" class="text-sm font-medium p-2 rounded-md hoverable-item">Séries</button>
                     <button id="desktop-list-button" class="text-sm font-medium p-2 rounded-md hoverable-item">Minha Lista</button>
                    <div class="relative" id="profile-dropdown-container">
                        <button id="profile-button" class="w-9 h-9 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full overflow-hidden" title="Perfil"><img src="https://placehold.co/40x40/ffffff/333333?text=A" alt="Avatar do Utilizador" class="w-full h-full object-cover"></button>
                        <div id="profile-menu" class="absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 hidden" style="background-color: var(--card-bg)">
                            <button id="theme-toggle" class="w-full text-left px-4 py-2 text-sm hoverable-item flex items-center justify-between">Tema <i data-lucide="sun" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
                <div class="lg:hidden">
                    <button id="hamburger-button"><i data-lucide="menu" class="w-7 h-7"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Painel de Navegação Mobile -->
    <div id="mobile-nav" class="modal fixed top-0 left-0 h-full w-full z-50 lg:hidden" style="background-color: var(--background)">
        <div class="p-4">
            <div class="flex justify-between items-center mb-8">
                <a href="#" class="text-2xl font-bold"><span class="text-blue-500">Cine</span><span class="text-purple-500">Verse</span></a>
                <button id="close-mobile-nav"><i data-lucide="x" class="w-7 h-7"></i></button>
            </div>
            <nav id="mobile-sidebar-nav" class="flex flex-col space-y-4 text-lg">
                <a href="#" data-nav="home" class="p-2 rounded-md hoverable-item">Início</a>
                <a href="#" data-nav="movies" class="p-2 rounded-md hoverable-item">Filmes</a>
                <a href="#" data-nav="series" class="p-2 rounded-md hoverable-item">Séries</a>
            </nav>
        </div>
    </div>

    <main class="overflow-x-hidden">
        <section id="hero-section" class="relative min-h-[60vh] md:min-h-[90vh] flex items-center">
            <!-- Conteúdo do Herói será populado por JS -->
        </section>

        <div id="content-container" class="py-8 md:py-12">
            <!-- Carrosséis ou outras páginas serão populados aqui -->
        </div>
    </main>
    
    <!-- Barra de Navegação Inferior (Mobile) -->
    <div class="fixed bottom-0 left-0 right-0 h-20 z-40 lg:hidden" style="background-color: var(--background); border-top: 1px solid var(--card-bg);">
        <div id="mobile-nav-bar" class="flex justify-around items-center h-full">
            <button data-nav="home" class="mobile-nav-item active flex flex-col items-center p-2"><i data-lucide="home" class="w-6 h-6 mb-1"></i><span class="text-sm">Início</span></button>
            <button data-nav="search" class="mobile-nav-item flex flex-col items-center p-2"><i data-lucide="search" class="w-6 h-6 mb-1"></i><span class="text-sm">Buscar</span></button>
            <button data-nav="list" class="mobile-nav-item flex flex-col items-center p-2"><i data-lucide="list-video" class="w-6 h-6 mb-1"></i><span class="text-sm">Minha Lista</span></button>
            <button id="mobile-profile-button" class="mobile-nav-item flex flex-col items-center p-2"><i data-lucide="user-2" class="w-6 h-6 mb-1"></i><span class="text-sm">Perfil</span></button>
        </div>
    </div>
    
    <!-- Modal de Detalhes de Filme -->
    <div id="details-modal" class="modal fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 p-4">
        <div id="details-modal-content" class="rounded-lg relative w-full max-w-4xl max-h-[90vh] overflow-y-auto" style="background-color: var(--card-bg);"></div>
    </div>
    
    <!-- Modal do Leitor de Vídeo -->
    <div id="player-modal" class="modal fixed inset-0 bg-black z-[51] flex flex-col">
        <div class="flex items-center justify-between p-4 bg-black/50">
            <h2 id="player-title" class="text-lg font-semibold text-white"></h2>
            <button id="close-player-modal" class="p-2"><i data-lucide="x" class="text-white"></i></button>
        </div>
        <div id="player-container" class="w-full h-full flex-1"></div>
    </div>
    
    <!-- Overlay de Perfil Mobile -->
    <div id="mobile-profile-overlay" class="modal fixed inset-0 z-50 p-4" style="background-color: var(--overlay-bg);">
        <div class="flex justify-end mb-4"><button id="close-profile-overlay"><i data-lucide="x" class="w-7 h-7"></i></button></div>
        <div class="mt-8 flex flex-col items-center space-y-6"><h2 class="text-2xl font-bold">Perfil</h2><button id="mobile-theme-toggle" class="p-4 rounded-md text-lg flex items-center justify-center hoverable-item w-full max-w-xs">Mudar Tema <i data-lucide="sun" class="w-5 h-5 ml-2"></i></button></div>
    </div>
    
    <!-- Modal de Busca -->
    <div id="search-modal" class="modal fixed inset-0 z-50 p-4 pt-16" style="background-color: var(--overlay-bg);">
        <div class="container mx-auto">
            <div class="flex items-center justify-between mb-4">
                <input type="text" id="search-input" placeholder="Buscar por filmes ou séries..." class="w-full p-3 rounded-md border-none text-lg" style="background-color: var(--card-bg); color: var(--text-primary);">
                <button id="close-search-modal" class="ml-2 p-2"><i data-lucide="x" class="w-8 h-8"></i></button>
            </div>
            <div id="search-results" class="max-h-[80vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="loading-spinner" class="fixed inset-0 flex justify-center items-center z-[60]" style="background-color: var(--background);"><div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500"></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- BANCO DE DADOS E ESTADO DA APLICAÇÃO ---
            const db = {
                movies: [
                    { id: 5, title: "Orion e o Escuro", year: "2024", rating: 4.6, genres: ["Animação", "Aventura", "Fantasia"], director: "Sean Charmatz", cast: ["Jacob Tremblay", "Paul Walter Hauser"], synopsis: "Um garoto com uma imaginação ativa enfrenta seus medos numa jornada pela noite...", poster: "https://upload.wikimedia.org/wikipedia/pt/f/f1/Orion_e_o_Escuro.jpg", backdrop: "https://occ-0-8407-92.1.nflxso.net/dnm/api/v6/E8vDc_W8CLv7-yMQu8KMEC7Rrr8/AAAABXj5BLHAmSR-leac11zR8tVvyNTQSxhPr1j_kgD6kvXVCxwbeUZapd-BZywoz4WtVmP7heJQTd0AkuWLCtClHRPP3UBM1DgLaNnu.jpg?r=25c", playerType: 'video', url: "https://1a-1791.com/video/fww1/ae/s8/2/4/B/G/w/4BGwy.gaa.mp4", progress: 0 },
                    { id: 13, title: "Ratatouille", year: "2007", rating: 4.8, genres: ["Animação", "Comédia", "Família"], director: "Brad Bird", cast: ["Patton Oswalt", "Ian Holm", "Lou Romano"], synopsis: "Um rato chamado Remy sonha em se tornar um grande chef francês, apesar dos desejos de sua família e do óbvio problema de ser um rato em uma profissão decididamente fóbica a roedores.", poster: "https://static.wikia.nocookie.net/dublagem/images/1/1d/Ratatouille_%282007%29_P%C3%B4ster.jpg/revision/latest?cb=20230719130039&path-prefix=pt-br", backdrop: "https://image.tmdb.org/t/p/original/uTSZLWiAIDxS6ELlmjHHtfNkTGP.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe2/fb/s8/2/2/X/V/S/2XVSx.gaa.mp4", progress: 0 },
                    { id: 14, title: "Moana - Um Mar de Aventuras", year: "2016", rating: 4.7, genres: ["Animação", "Aventura", "Família"], director: "Ron Clements, John Musker", cast: ["Auli'i Cravalho", "Dwayne Johnson", "Rachel House"], synopsis: "Moana, uma jovem corajosa, parte em uma missão ousada para salvar seu povo. Durante sua jornada, ela encontra o poderoso semideus Maui, que a guia em sua busca para se tornar uma mestre navegadora.", poster: "https://br.web.img3.acsta.net/pictures/16/09/12/22/13/415370.jpg", backdrop: "https://image.tmdb.org/t/p/original/kNAANuEyhDu5g4c5p0gcMFLhV0k.jpg", playerType: 'video', url: "https://1a-1791.com/video/s8/2/K/T/8/c/KT8cv.gaa.mp4", progress: 0 },
                    { id: 15, title: "O Gato das Botas", year: "2011", rating: 4.4, genres: ["Animação", "Aventura", "Comédia"], director: "Chris Miller", cast: ["Antonio Banderas", "Salma Hayek", "Zach Galifianakis"], synopsis: "Muito antes de conhecer Shrek, o notório lutador e amante Gato de Botas torna-se um herói ao embarcar em uma aventura com a durona e esperta Kitty Pata-Mansa e o mestre Humpty Dumpty.", poster: "https://br.web.img3.acsta.net/medias/nmedia/18/89/67/23/20061404.jpg", backdrop: "https://image.tmdb.org/t/p/original/cC5CR0EBTbgw6UUd8EsHfw3e5N5.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe1/dd/s8/2/J/P/q/m/JPqmx.gaa.mp4", progress: 0 },
                    { id: 16, title: "Gato de Botas 2: O Último Pedido", year: "2022", rating: 4.9, genres: ["Animação", "Aventura", "Comédia"], director: "Joel Crawford", cast: ["Antonio Banderas", "Salma Hayek", "Harvey Guillén"], synopsis: "O Gato de Botas descobre que sua paixão pela aventura cobrou seu preço: ele queimou oito de suas nove vidas. Gato parte em uma jornada épica para encontrar o mítico Último Desejo e restaurar suas nove vidas.", poster: "https://m.media-amazon.com/images/S/pv-target-images/af89ec33729d1d14d78507f10f3aa4e3be74093c22a149a90268a39435bc6a82.jpg", backdrop: "https://image.tmdb.org/t/p/original/u8XDx5S8RWc2UgCGc7HHwFWVE2a.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe1/8c/s8/2/u/I/-/a/uI-ax.gaa.mp4", progress: 0 },
                    { id: 17, title: "Como Treinar o Seu Dragão", year: "2010", rating: 4.8, genres: ["Animação", "Aventura", "Fantasia"], director: "Dean DeBlois, Chris Sanders", cast: ["Jay Baruchel", "Gerard Butler", "Craig Ferguson"], synopsis: "Um jovem Viking desafortunado que aspira a caçar dragões torna-se o amigo improvável de um jovem dragão e aprende que pode haver mais nas criaturas do que ele imaginava.", poster: "https://upload.wikimedia.org/wikipedia/pt/e/ed/How_to_Train_Your_Dragon_%28filme_de_2010%29.jpg", backdrop: "https://image.tmdb.org/t/p/original/sUxsHQtSxfwmXkoqNlB7Uyl0kaN.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe1/b3/s8/2/b/4/9/-/b49-w.gaa.mp4", progress: 0 },
                    { id: 18, title: "Como Treinar o Seu Dragão 2", year: "2014", rating: 4.8, genres: ["Animação", "Aventura", "Fantasia"], director: "Dean DeBlois", cast: ["Jay Baruchel", "Cate Blanchett", "Gerard Butler"], synopsis: "Quando Soluço e Banguela descobrem uma caverna de gelo que é o lar de centenas de novos dragões selvagens e do misterioso Cavaleiro do Dragão, os dois amigos se encontram no centro de uma batalha para proteger a paz.", poster: "https://br.web.img2.acsta.net/pictures/14/05/27/21/27/291561.jpg", backdrop: "https://image.tmdb.org/t/p/original/3y407ibkG1VZvcN6cZlvQexvuxp.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe2/47/s8/2/K/A/B/6/KAB6w.gaa.mp4", progress: 0 },
                    { id: 19, title: "Como Treinar o Seu Dragão 3", year: "2019", rating: 4.7, genres: ["Animação", "Aventura", "Fantasia"], director: "Dean DeBlois", cast: ["Jay Baruchel", "America Ferrera", "F. Murray Abraham"], synopsis: "Quando Soluço realiza seu sonho de criar uma utopia pacífica de dragões, a descoberta de Banguela de uma companheira indomável e esquiva atrai o Fúria da Noite para longe. Quando o perigo ameaça a aldeia, o reinado de Soluço como chefe é testado.", poster: "https://br.web.img2.acsta.net/c_310_420/pictures/18/11/13/12/10/5661398.jpg", backdrop: "https://image.tmdb.org/t/p/original/g8a2FT8DWi1e6Fpw7zqrcKWbe8n.jpg", playerType: 'video', url: "https://1a-1791.com/video/fwe2/ce/s8/2/w/2/_/-/w2_-w.gaa.mp4", progress: 0 },
                    { id: 12, title: "Como Treinar o Seu Dragão", year: "2025", rating: 4.5, genres: ["Ação", "Aventura", "Fantasia"], director: "Dean DeBlois", cast: ["Mason Thames", "Nico Parker", "Gerard Butler"], synopsis: "Uma nova adaptação em live-action da amada história de um jovem Viking e seu temível dragão Fúria da Noite.", poster: "https://ingresso-a.akamaihd.net/prd/img/movie/como-treinar-o-seu-dragao/89a43f9e-2a94-4271-a698-d6ddfb7c7908.webp", backdrop: "https://image.tmdb.org/t/p/original/lX4GUbN2J8WqUh6nJ4r0bGOm0hm.jpg", playerType: 'video', url: "https://f005.backblazeb2.com/file/s7rave/Como%20treinar%20o%20seu%20dragao%20dublado.mp4", progress: 0 },
                    { id: 3, title: "O Segredo dos Animais", year: "2006", rating: 4.1, genres: ["Comédia", "Animação"], director: "Steve Oedekerk", cast: ["Kevin James", "Courteney Cox"], synopsis: "Quando o fazendeiro está fora, todos os animais da fazenda cantam e dançam...", poster: "https://br.web.img3.acsta.net/medias/nmedia/18/94/12/17/20304560.jpg", backdrop: "https://http2.mlstatic.com/D_NQ_NP_751137-MLA73368651374_122023-B.webp", playerType: 'video', url: "https://1a-1791.com/video/fww1/ab/s8/2/o/e/2/s/oe2sy.gaa.mp4", progress: 50 },
                    { id: 4, title: "A Nova Onda do Imperador", year: "2000", rating: 4.7, genres: ["Comédia", "Animação", "Aventura"], director: "Mark Dindal", cast: ["David Spade", "John Goodman"], synopsis: "O arrogante imperador Kuzco é transformado em uma lhama...", poster: "https://m.media-amazon.com/images/M/MV5BMjBkMWE4ZjUtZTgxYi00MjRlLWIyYWYtY2M2ZWQ2YzA3OTgyXkEyXkFqcGc@._V1_.jpg", backdrop: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFDmG7HE_dd27sbKKLDzeZGzu95qaL2WUrTXspfaBNANTSJkTFvxbMcqqmto_MTH05C6XSW85CXpNIiyE8MQEzmG06xefmAiuale1SZaP5IMh17pRBS08vIdRDvxsz06ri6T2KToVw9Uk/s1000/a+nova+onda+do+imperador.png", playerType: 'video', url: "https://1a-1791.com/video/fwe1/8b/s8/2/k/P/h/x/kPhxy.caa.mp4", progress: 0 },
                    { id: 2, title: "Pica-Pau: O Filme", year: "2017", rating: 3.8, genres: ["Comédia", "Animação", "Aventura"], director: "Alex Zamm", cast: ["Timothy Omundson", "Thaila Ayala"], synopsis: "O Pica-Pau está metido em mais uma de suas brigas por território...", poster: "https://br.web.img2.acsta.net/pictures/17/08/25/19/04/419991.jpg", backdrop: "https://www.themoviedb.org/t/p/original/rS3uTcmmS8b0Yw3aLp4iS2B2T21.jpg", playerType: 'iframe', url: "https://www.tokyvideo.com/embed/409976", progress: 0 },
                    { id: 6, title: "Patos!", year: "2023", rating: 4.4, genres: ["Animação", "Aventura", "Comédia"], director: "Benjamin Renner", cast: ["Kumail Nanjiani", "Elizabeth Banks"], synopsis: "Uma família de patos tenta convencer seu pai a embarcar nas férias de suas vidas...", poster: "https://br.web.img2.acsta.net/pictures/23/12/07/19/08/2800297.jpg", backdrop: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhiHQEZwHPftCEbCl9A7Y0FDNCCyY63UzTzcw4jC9qsR78PsH_J5xely5IjIV9kr4KgBPMWRvdJXGL2pYnHIIKjDvDQnivL4esBc60uecHi4oZuP-SVyLw26sQ1ZaWF6zmZp89uSbjcGfTFD6-HLY6V1d-bBExjwMeZefxg-MH_6CdyNBYvawMcGUrQ9WMt/s1640/Patos%20cover.jpg", playerType: 'video', url: "https://1a-1791.com/video/fww1/26/s8/2/G/0/G/w/G0Gwy.gaa.mp4", progress: 20 },
                    { id: 7, title: "WiFi Ralph", year: "2018", rating: 4.3, genres: ["Animação", "Comédia", "Aventura"], director: "Rich Moore", cast: ["John C. Reilly", "Sarah Silverman"], synopsis: "Ralph e Vanellope descobrem um roteador wi-fi em seu fliperama...", poster: "https://br.web.img3.acsta.net/pictures/18/10/29/20/33/4244487.jpg", backdrop: "https://files.meiobit.com/wp-content/uploads/2018/11/20181130ralph-001.jpg", playerType: 'video', url: "https://1a-1791.com/video/fww1/45/s8/2/6/1/J/w/61Jwy.gaa.mp4", progress: 0 },
                    { id: 8, title: "Detona Ralph", year: "2012", rating: 4.5, genres: ["Animação", "Comédia", "Aventura"], director: "Rich Moore", cast: ["John C. Reilly", "Sarah Silverman"], synopsis: "Um vilão de videogame quer provar que pode ser um herói...", poster: "https://musicart.xboxlive.com/7/82621100-0000-0000-0000-000000000002/504/image.jpg", backdrop: "https://m.media-amazon.com/images/S/pv-target-images/9db2a8d2cd5e2a588220a032ed4a5daae0b93c04ea8fda8716701e69200ee421._SX1080_FMjpg_.jpg", playerType: 'video', url: "https://1a-1791.com/video/fww1/b0/s8/2/0/1/J/w/01Jwy.gaa.mp4", progress: 0 },
                    { id: 9, title: "Enrolados", year: "2010", rating: 4.8, genres: ["Animação", "Aventura", "Romance"], director: "Nathan Greno", cast: ["Mandy Moore", "Zachary Levi"], synopsis: "Rapunzel, com seu cabelo mágico, faz um acordo com o ladrão Flynn Rider...", poster: "https://a-static.mlcdn.com.br/800x560/dvd-enrolados-lacrado-disney/videoimpacto/8320145385/7657b9fed71739c7563e6b346015c61d.jpg", backdrop: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhEFR_J4w6veFIbYfEzl7Vgg_I4um9o0JUfNTWE8IiL1LrN_TNH6fD0MaTvg9yNV8fCZZAVhX9kLl_Cnphw8scYd5apRm62FhEg6x-jjwJX5peGv6mVJq8lGma_XzqAzrYkYVSgV81HTOk/s1000/enrolados.png", playerType: 'video', url: "https://1a-1791.com/video/fww1/5f/s8/2/g/J/K/t/gJKty.gaa.mp4", progress: 80 },
                    { id: 10, title: "Elementos", year: "2023", rating: 4.6, genres: ["Animação", "Comédia", "Fantasia", "Romance"], director: "Peter Sohn", cast: ["Leah Lewis", "Mamoudou Athie"], synopsis: "Numa cidade onde vivem residentes de fogo, água, terra e ar...", poster: "https://lumiere-a.akamaihd.net/v1/images/elemental_bport_765442cf.png", backdrop: "https://lumiere-a.akamaihd.net/v1/images/lineup_my-element_03_5368a525.jpeg?region=0,1,1200,675&width=960", playerType: 'video', url: "https://1a-1791.com/video/fww1/eb/s8/2/c/y/v/u/cyvuy.gaa.mp4", progress: 0 },
                    { id: 11, title: "Moana 2", year: "2024", rating: 4.9, genres: ["Animação", "Aventura", "Fantasia"], director: "David G. Derrick Jr.", cast: ["Auli'i Cravalho", "Dwayne Johnson"], synopsis: "Moana embarca numa nova jornada com Maui...", poster: "https://upload.wikimedia.org/wikipedia/pt/thumb/7/73/Moana_2_poster.jpg/250px-Moana_2_poster.jpg", backdrop: "https://disney.images.edge.bamgrid.com/ripcut-delivery/v2/variant/disney/ac70c442-571e-48ae-8733-7494bd7d27c6/compose?aspectRatio=1.78&format=webp&width=1200", playerType: 'video', url: "https://1a-1791.com/video/fwe2/04/s8/2/s/x/t/s/sxtsy.gaa.mp4", progress: 0 }
                ],
                series: [
                    {
                        id: "pica-pau",
                        title: "Pica-Pau",
                        cover: "https://media.themoviedb.org/t/p/w600_and_h900_bestv2/aXgyvCWLPkbZUCYR822KLsKZXgt.jpg",
                        backdrop: "https://www.themoviedb.org/t/p/original/rS3uTcmmS8b0Yw3aLp4iS2B2T21.jpg",
                        synopsis: "As aventuras clássicas e hilárias do Pica-Pau, um pássaro icônico conhecido por sua risada contagiante e suas travessuras intermináveis contra seus adversários.",
                        seasons: [
                            {
                                id: "season-1940",
                                title: "Temporada 1 (1940)",
                                episodes: [
                                    { videoUrl: "https://files.catbox.moe/mj23l1.mp4", title: "Pica-Pau Ataca Novamente" },
                                    { videoUrl: "https://files.catbox.moe/1onuvg.mp4", title: "O Pica-Pau Biruta" },
                                    { videoUrl: "https://files.catbox.moe/fm8er6.mp4", title: "O Biruta" },
                                    { videoUrl: "https://files.catbox.moe/3vlf67.mp4", title: "Pânico na Cozinha" },
                                    { videoUrl: "https://files.catbox.moe/opgp7j.mp4", title: "O Matador de Hollywood" },
                                    { videoUrl: "https://files.catbox.moe/13r6tn.mp4", title: "Um Ás de Mais" },
                                    { videoUrl: "https://files.catbox.moe/2tsdpm.mp4", title: "A Loja do Prego" },
                                    { videoUrl: "https://files.catbox.moe/eg8s85.mp4", title: "Beisebol Maluco" },
                                    { videoUrl: "https://files.catbox.moe/3lths3.mp4", title: "O Acrobata Maluco" },
                                    { videoUrl: "https://files.catbox.moe/35fv2h.mp4", title: "O Afanador de Gasolina" }
                                ]
                            },
                            {
                                id: "season-1944",
                                title: "Temporada 2 (1944)",
                                episodes: [
                                    { videoUrl: "https://files.catbox.moe/04glch.mp4", title: "O Barbeiro de Sevilha" },
                                    { videoUrl: "https://files.catbox.moe/0w74ed.mp4", title: "O Doido da Praia" },
                                    { videoUrl: "https://files.catbox.moe/rxt33w.mp4", title: "Ski Para Dois" },
                                    { videoUrl: "https://files.catbox.moe/2jn2cq.mp4", title: "Uma Dama Muito Fina" },
                                    { videoUrl: "https://files.catbox.moe/ainphs.mp4", title: "O Pica-Pau Come Fora" },
                                    { videoUrl: "https://files.catbox.moe/tj1f0o.mp4", title: "O Famoso Diplomata" },
                                    { videoUrl: "https://files.catbox.moe/z9vbpa.mp4", title: "O Biruta à Solta" },
                                    { videoUrl: "https://files.catbox.moe/ha4ilo.mp4", title: "Quem Cozinha Quem" },
                                    { videoUrl: "https://files.catbox.moe/b79gdf.mp4", title: "A Hora do Banho" },
                                    { videoUrl: "https://files.catbox.moe/6czmzf.mp4", title: "Motorista Desleixado" }
                                ]
                            }
                        ]
                    }
                ],
                carousels: [
                    { title: "Populares na CineVerse", filter: (m) => m.rating >= 4.5 },
                    { title: "Saga Como Treinar o Seu Dragão", filter: (m) => m.title.includes("Como Treinar o Seu Dragão") },
                    { title: "Continuar a Assistir", filter: (m) => m.progress > 0 && m.progress < 100 },
                    { title: "Animações Imperdíveis", filter: (m) => m.genres.includes("Animação") },
                    { title: "Comédias para Rir à Vontade", filter: (m) => m.genres.includes("Comédia") },
                    { title: "Aventuras Épicas", filter: (m) => m.genres.includes("Aventura") }
                ]
            };
            let myList = JSON.parse(localStorage.getItem('myList')) || [];

            const DOMElements = {
                html: document.documentElement, loadingSpinner: document.getElementById('loading-spinner'), themeToggle: document.getElementById('theme-toggle'), profileBtn: document.getElementById('profile-button'), profileMenu: document.getElementById('profile-menu'), profileDropdownContainer: document.getElementById('profile-dropdown-container'), hamburgerBtn: document.getElementById('hamburger-button'), mobileNav: document.getElementById('mobile-nav'), closeMobileNav: document.getElementById('close-mobile-nav'), playerModal: { container: document.getElementById('player-modal'), closeBtn: document.getElementById('close-player-modal'), playerContainer: document.getElementById('player-container'), title: document.getElementById('player-title') }, detailsModal: { container: document.getElementById('details-modal'), content: document.getElementById('details-modal-content') }, contentContainer: document.getElementById('content-container'), heroSection: document.getElementById('hero-section'), mobileProfileBtn: document.getElementById('mobile-profile-button'), mobileProfileOverlay: document.getElementById('mobile-profile-overlay'), closeProfileOverlay: document.getElementById('close-profile-overlay'), mobileThemeToggle: document.getElementById('mobile-theme-toggle'), homeLink: document.getElementById('home-link'), mobileNavBar: document.getElementById('mobile-nav-bar'), desktopListBtn: document.getElementById('desktop-list-button'), desktopMoviesBtn: document.getElementById('desktop-movies-button'), desktopSeriesBtn: document.getElementById('desktop-series-button'), desktopSearchBtn: document.getElementById('desktop-search-button'), searchModal: { container: document.getElementById('search-modal'), input: document.getElementById('search-input'), results: document.getElementById('search-results'), closeBtn: document.getElementById('close-search-modal') }
            };

            // --- FUNÇÕES DE RENDERIZAÇÃO ---
            function renderHomePage() {
                DOMElements.contentContainer.className = 'py-8 md:py-12';
                DOMElements.heroSection.style.display = 'flex';
                renderHero();
                renderAllCarousels();
                updateActiveNav('home');
            }

            function renderHero() {
                const heroMovie = db.movies[0];
                DOMElements.heroSection.innerHTML = `
                    <div class="absolute inset-0"><img src="${heroMovie.backdrop}" alt="${heroMovie.title}" class="w-full h-full object-cover"><div class="absolute inset-0 hero-gradient-left"></div><div class="absolute inset-0 hero-gradient-bottom"></div></div>
                    <div class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="max-w-xl">
                            <h1 class="text-4xl md:text-6xl font-extrabold my-3" style="color: var(--hero-text-primary);">${heroMovie.title}</h1>
                            <p class="text-lg md:text-xl mb-6 leading-relaxed" style="color: var(--hero-text-secondary);">${heroMovie.synopsis}</p>
                            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                                <button class="details-btn flex items-center justify-center bg-white text-black font-bold py-3.5 px-8 rounded-md transition hover:bg-gray-300" data-movie-id="${heroMovie.id}"><i data-lucide="info" class="mr-2"></i>Mais Informações</button>
                                <button class="add-to-list-btn flex items-center justify-center bg-gray-500 bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm font-bold py-3.5 px-8 rounded-full transition duration-300" style="color: var(--hero-text-primary);" data-movie-id="${heroMovie.id}"></button>
                            </div>
                        </div>
                    </div>`;
                updateAddToListButton(DOMElements.heroSection.querySelector('.add-to-list-btn'));
            }

            function renderAllCarousels() {
                DOMElements.contentContainer.innerHTML = '<div class="space-y-12 md:space-y-16"></div>';
                const carouselWrapper = DOMElements.contentContainer.firstChild;
                db.carousels.forEach(carouselConfig => {
                    const movies = db.movies.filter(carouselConfig.filter);
                    if (movies.length > 0) {
                        carouselWrapper.innerHTML += createCarouselHTML(carouselConfig.title, movies);
                    }
                });
            }

            function createCarouselHTML(title, movies) {
                return `
                    <section class="container mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-2xl md:text-3xl font-bold mb-4">${title}</h2>
                        <div class="relative"><div class="carousel-container flex overflow-x-auto space-x-4 py-4 -mx-4 px-4">${movies.map(createCarouselMovieCardHTML).join('')}</div></div>
                    </section>`;
            }

            function createCarouselMovieCardHTML(movie) {
                return `<div class="details-btn flex-shrink-0 w-1/2 sm:w-1/3 md:w-1/5 lg:w-1/6 rounded-lg transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer group" data-movie-id="${movie.id}"><div class="relative rounded-lg overflow-hidden aspect-[2/3]" style="background-color: var(--card-bg);"><img loading="lazy" src="${movie.poster}" alt="Pôster de ${movie.title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x450/1f2937/e5e7eb?text=Imagem+Indisponível';"></div></div>`;
            }

            function createGridMovieCardHTML(movie) {
                return `<div class="details-btn rounded-lg transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer group" data-movie-id="${movie.id}"><div class="relative rounded-lg overflow-hidden aspect-[2/3]" style="background-color: var(--card-bg);"><img loading="lazy" src="${movie.poster}" alt="Pôster de ${movie.title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x450/1f2937/e5e7eb?text=Imagem+Indisponível';"></div></div>`;
            }
            
            function renderMyListPage() {
                DOMElements.contentContainer.className = 'py-8 md:py-12';
                DOMElements.heroSection.style.display = 'none';
                updateActiveNav('list');
                const listMovies = db.movies.filter(m => myList.includes(m.id));
                let contentHTML = `<div class="container mx-auto px-4 sm:px-6 lg:px-8"><h2 class="text-2xl md:text-3xl font-bold mb-8">Minha Lista</h2>`;
                if (listMovies.length > 0) {
                    contentHTML += `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-4">${listMovies.map(createGridMovieCardHTML).join('')}</div>`;
                } else {
                    contentHTML += `<div class="text-center py-16" style="color: var(--text-secondary);"><i data-lucide="list-x" class="w-16 h-16 mx-auto mb-4"></i><h3 class="text-xl font-semibold">Sua lista está vazia</h3><p class="mt-2">Adicione filmes e séries para vê-los aqui.</p></div>`;
                }
                contentHTML += '</div>';
                DOMElements.contentContainer.innerHTML = contentHTML;
                lucide.createIcons();
            }

            function renderCategoryPage(pageTitle, items, emptyMessage, cardRenderer) {
                DOMElements.contentContainer.className = 'py-8 md:py-12';
                DOMElements.heroSection.style.display = 'none';
                updateActiveNav('');
                let contentHTML = `<div class="container mx-auto px-4 sm:px-6 lg:px-8"><h2 class="text-2xl md:text-3xl font-bold mb-8">${pageTitle}</h2>`;
                if (items.length > 0) {
                    contentHTML += `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-4">${items.map(cardRenderer).join('')}</div>`;
                } else {
                    contentHTML += `<div class="text-center py-16" style="color: var(--text-secondary);"><i data-lucide="tv-2" class="w-16 h-16 mx-auto mb-4"></i><h3 class="text-xl font-semibold">${emptyMessage.title}</h3><p class="mt-2">${emptyMessage.subtitle}</p></div>`;
                }
                contentHTML += '</div>';
                DOMElements.contentContainer.innerHTML = contentHTML;
                lucide.createIcons();
            }

            function showDetailsModal(movieId) {
                const movie = db.movies.find(m => m.id == movieId);
                if (!movie) return;
                
                const castUrl = `wvc-x-callback://open?url=${encodeURIComponent(movie.url)}&title=${encodeURIComponent(movie.title)}`;

                DOMElements.detailsModal.content.innerHTML = `
                    <div class="relative">
                        <img src="${movie.backdrop}" alt="${movie.title}" class="w-full h-48 md:h-72 object-cover rounded-t-lg" onerror="this.onerror=null;this.src='https://placehold.co/800x400/1f2937/e5e7eb?text=Imagem+Indisponível';">
                        <div class="absolute inset-0 bg-gradient-to-t from-[var(--card-bg)] to-transparent"></div>
                        <button id="close-details-modal" class="absolute top-3 right-3 bg-black/50 rounded-full p-1.5"><i data-lucide="x"></i></button>
                    </div>
                    <div class="p-4 md:p-6">
                        <h2 class="text-3xl font-bold">${movie.title} (${movie.year})</h2>
                        <div class="flex flex-wrap items-center my-2 gap-x-4 gap-y-2 text-sm" style="color: var(--text-secondary)">
                            <div class="flex items-center text-yellow-400">${'★'.repeat(Math.round(movie.rating))}${'☆'.repeat(5 - Math.round(movie.rating))} <span class="ml-2" style="color: var(--text-primary);">${movie.rating}</span></div>
                            <span>${movie.genres.join(', ')}</span>
                        </div>
                        <p class="my-4">${movie.synopsis}</p>
                        <div class="text-sm space-y-1">
                            <p><strong style="color: var(--text-primary)">Diretor:</strong> ${movie.director}</p>
                            <p><strong style="color: var(--text-primary)">Elenco:</strong> ${movie.cast.join(', ')}</p>
                        </div>
                        <div class="flex flex-wrap gap-3 mt-6">
                            <button class="watch-btn flex-1 flex items-center justify-center bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-5 rounded-lg transition" data-movie-id="${movie.id}"><i data-lucide="play" class="mr-2"></i>Assistir</button>
                            <button class="add-to-list-btn flex-1 flex items-center justify-center border font-bold py-3 px-5 rounded-lg transition hoverable-item" style="border-color: var(--text-secondary);" data-movie-id="${movie.id}"></button>
                            <a href="${castUrl}" class="p-3 flex items-center justify-center border rounded-lg transition hoverable-item" style="border-color: var(--text-secondary);" title="Transmitir"><i data-lucide="cast"></i></a>
                            <a href="${movie.url}" download="${movie.title}" class="p-3 flex items-center justify-center border rounded-lg transition hoverable-item" style="border-color: var(--text-secondary);" title="Baixar"><i data-lucide="download"></i></a>
                        </div>
                        <div class="mt-8 border-t pt-6" style="border-color: var(--card-hover-bg);">
                            <h3 class="text-xl font-bold mb-4">Avalie e Comente</h3>
                            <div class="star-rating mb-4 flex items-center gap-1" data-id="movie-${movie.id}">
                                ${[1,2,3,4,5].map(i => `<i data-lucide="star" data-value="${i}" class="w-7 h-7"></i>`).join('')}
                            </div>
                            <form class="comment-form" data-id="movie-${movie.id}">
                                <textarea class="w-full p-2 rounded-md border-none mb-2" style="background-color: var(--card-hover-bg); color: var(--text-primary);" placeholder="Deixe seu comentário..."></textarea>
                                <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition">Enviar</button>
                            </form>
                            <div class="comments-section mt-4 space-y-3"></div>
                        </div>
                    </div>`;
                
                updateAddToListButton(DOMElements.detailsModal.content.querySelector('.add-to-list-btn'));
                DOMElements.detailsModal.container.classList.add('active');
                lucide.createIcons();
                document.getElementById('close-details-modal').onclick = () => DOMElements.detailsModal.container.classList.remove('active');
                setupRatingAndComments(`movie-${movie.id}`);
            }

            function openPlayerModal(movieId) {
                const movie = db.movies.find(m => m.id == movieId);
                if (!movie) return;
                DOMElements.playerModal.title.textContent = movie.title;
                DOMElements.playerModal.playerContainer.innerHTML = `<video id="player-video" class="w-full h-full" src="${movie.url}" controls autoplay></video>`;
                DOMElements.detailsModal.container.classList.remove('active');
                DOMElements.playerModal.container.classList.add('active');
            }

            function openPlayerModalForEpisode(videoUrl, title) {
                DOMElements.playerModal.title.textContent = title;
                DOMElements.playerModal.playerContainer.innerHTML = `<video id="player-video" class="w-full h-full" src="${videoUrl}" controls autoplay></video>`;
                DOMElements.playerModal.container.classList.add('active');
            }

            function closePlayerModal() {
                DOMElements.playerModal.playerContainer.innerHTML = '';
                DOMElements.playerModal.container.classList.remove('active');
                if (document.fullscreenElement) document.exitFullscreen();
            }
            
            // --- RENDERIZAÇÃO DE SÉRIES ---
            function createSeriesCardHTML(series) {
                return `<div class="series-card rounded-lg transform hover:-translate-y-2 transition-transform duration-300 cursor-pointer group" data-series-id="${series.id}"><div class="relative rounded-lg overflow-hidden aspect-[2/3]" style="background-color: var(--card-bg);"><img loading="lazy" src="${series.cover}" alt="Capa de ${series.title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/300x450/1f2937/e5e7eb?text=Imagem+Indisponível';"></div></div>`;
            }

            function renderSeriesDetailsPage(seriesId) {
                const series = db.series.find(s => s.id === seriesId);
                if (!series) return;

                DOMElements.heroSection.style.display = 'none';
                DOMElements.contentContainer.className = ''; // Remove padding for full-width hero
                updateActiveNav('');

                const seasonOptionsHTML = series.seasons.map(season => `
                    <option value="${season.id}">${season.title}</option>
                `).join('');

                DOMElements.contentContainer.innerHTML = `
                    <div class="relative w-full h-[40vh] md:h-[60vh]">
                        <img src="${series.backdrop}" alt="${series.title}" class="absolute inset-0 w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-[var(--background)] via-transparent to-transparent"></div>
                        <div class="absolute bottom-0 left-0 p-4 md:p-8 container mx-auto">
                            <h2 class="text-3xl md:text-5xl font-bold" style="color: var(--hero-text-primary); text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">${series.title}</h2>
                            <p class="max-w-2xl mt-2 text-sm" style="color: var(--hero-text-secondary); text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">${series.synopsis || ''}</p>
                        </div>
                    </div>
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8 mt-8">
                        <div class="mb-6">
                            <select id="season-selector" class="w-full sm:w-auto p-3 rounded-md font-semibold border-none cursor-pointer" style="background-color: var(--card-bg); color: var(--text-primary); border: 1px solid var(--card-hover-bg);">
                                ${seasonOptionsHTML}
                            </select>
                        </div>
                        <div id="episodes-list" class="mt-6 space-y-3"></div>
                        <div class="mt-8 border-t pt-6" style="border-color: var(--card-hover-bg);">
                            <h3 class="text-xl font-bold mb-4">Avalie e Comente</h3>
                            <div class="star-rating mb-4 flex items-center gap-1" data-id="series-${series.id}">
                                ${[1,2,3,4,5].map(i => `<i data-lucide="star" data-value="${i}" class="w-7 h-7"></i>`).join('')}
                            </div>
                            <form class="comment-form" data-id="series-${series.id}">
                                <textarea class="w-full p-2 rounded-md border-none mb-2" style="background-color: var(--card-hover-bg); color: var(--text-primary);" placeholder="Deixe seu comentário..."></textarea>
                                <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition">Enviar</button>
                            </form>
                            <div class="comments-section mt-4 space-y-3"></div>
                        </div>
                    </div>
                `;

                const renderEpisodes = (seasonId) => {
                    const season = series.seasons.find(s => s.id === seasonId);
                    if (!season) return;
                    document.getElementById('episodes-list').innerHTML = season.episodes.map((ep, index) => {
                        const castUrl = `wvc-x-callback://open?url=${encodeURIComponent(ep.videoUrl)}&title=${encodeURIComponent(ep.title)}`;
                        return `
                        <div class="w-full text-left p-3 rounded-lg hoverable-item flex items-center gap-4">
                            <span class="text-lg font-semibold" style="color: var(--text-secondary);">${index + 1}</span>
                            <div class="flex-1"><p class="font-semibold">${ep.title}</p></div>
                            <div class="flex items-center gap-2">
                                <a href="${castUrl}" class="p-2 rounded-full hover:bg-[var(--card-hover-bg)]" title="Transmitir"><i data-lucide="cast" class="w-5 h-5"></i></a>
                                <a href="${ep.videoUrl}" download="${ep.title}" class="p-2 rounded-full hover:bg-[var(--card-hover-bg)]" title="Baixar"><i data-lucide="download" class="w-5 h-5"></i></a>
                                <button class="episode-item p-2 rounded-full hover:bg-[var(--card-hover-bg)]" data-video-url="${ep.videoUrl}" data-video-title="${ep.title}" title="Assistir">
                                    <i data-lucide="play-circle" class="w-6 h-6"></i>
                                </button>
                            </div>
                        </div>`
                    }).join('');
                    lucide.createIcons();
                };

                const seasonSelector = document.getElementById('season-selector');
                seasonSelector.addEventListener('change', (e) => renderEpisodes(e.target.value));

                if (series.seasons.length > 0) {
                    renderEpisodes(series.seasons[0].id);
                }
                lucide.createIcons();
                setupRatingAndComments(`series-${series.id}`);
            }

            // --- FUNÇÕES DE UTILIDADE E LÓGICA ---
            const saveMyList = () => localStorage.setItem('myList', JSON.stringify(myList));

            function toggleMovieInList(movieId) {
                const id = parseInt(movieId);
                const index = myList.indexOf(id);
                if (index > -1) {
                    myList.splice(index, 1);
                } else {
                    myList.push(id);
                }
                saveMyList();
                document.querySelectorAll(`.add-to-list-btn[data-movie-id="${id}"]`).forEach(updateAddToListButton);
            }

            function updateAddToListButton(button) {
                if (!button) return;
                const movieId = parseInt(button.dataset.movieId);
                const isInList = myList.includes(movieId);
                if (isInList) {
                    button.innerHTML = `<i data-lucide="check" class="mr-2"></i>Na Minha Lista`;
                } else {
                    button.innerHTML = `<i data-lucide="plus" class="mr-2"></i>Minha Lista`;
                }
                lucide.createIcons();
            }

            function updateActiveNav(activeItem) {
                DOMElements.mobileNavBar.querySelectorAll('.mobile-nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.nav === activeItem);
                });
            }

            function toggleTheme() {
                DOMElements.html.classList.toggle('light');
                DOMElements.html.classList.toggle('dark');
                localStorage.setItem('theme', DOMElements.html.classList.contains('dark') ? 'dark' : 'light');
                if (DOMElements.heroSection.style.display === 'flex') {
                    renderHero();
                }
                updateThemeIcons();
            }
            
            function updateThemeIcons() {
                const isLight = DOMElements.html.classList.contains('light');
                const newIconName = isLight ? 'moon' : 'sun';
                [DOMElements.themeToggle, DOMElements.mobileThemeToggle].forEach(btn => {
                    if (btn) {
                        const icon = btn.querySelector('i, svg');
                        if (icon) {
                            icon.setAttribute('data-lucide', newIconName);
                        }
                    }
                });
                lucide.createIcons();
            }
            
            // --- LÓGICA DE BUSCA ---
            function performSearch() {
                const query = DOMElements.searchModal.input.value.toLowerCase().trim();
                if (query.length < 2) {
                    DOMElements.searchModal.results.innerHTML = '<p class="text-center p-4" style="color: var(--text-secondary);">Digite pelo menos 2 caracteres para buscar.</p>';
                    return;
                }

                const movieResults = db.movies.filter(m => m.title.toLowerCase().includes(query));
                const seriesResults = db.series.filter(s => s.title.toLowerCase().includes(query));

                let resultsHTML = '';
                if (movieResults.length > 0) {
                    resultsHTML += `<h3 class="text-xl font-bold p-4">Filmes</h3><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-4 p-4">${movieResults.map(createGridMovieCardHTML).join('')}</div>`;
                }
                if (seriesResults.length > 0) {
                    resultsHTML += `<h3 class="text-xl font-bold p-4">Séries</h3><div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-4 p-4">${seriesResults.map(createSeriesCardHTML).join('')}</div>`;
                }

                if (resultsHTML === '') {
                    DOMElements.searchModal.results.innerHTML = '<p class="text-center p-4" style="color: var(--text-secondary);">Nenhum resultado encontrado.</p>';
                } else {
                    DOMElements.searchModal.results.innerHTML = resultsHTML;
                }
                lucide.createIcons();
            }

            // --- LÓGICA DE AVALIAÇÃO E COMENTÁRIOS ---
            function setupRatingAndComments(contentId) {
                const ratingContainer = document.querySelector(`.star-rating[data-id="${contentId}"]`);
                const commentForm = document.querySelector(`.comment-form[data-id="${contentId}"]`);
                const commentsSection = document.querySelector(`.comment-form[data-id="${contentId}"] + .comments-section`);

                // Carregar e exibir
                const savedRating = localStorage.getItem(`rating_${contentId}`) || 0;
                const savedComments = JSON.parse(localStorage.getItem(`comments_${contentId}`)) || [];
                
                function displayStars(rating) {
                    ratingContainer.querySelectorAll('i').forEach(star => {
                        const starValue = parseInt(star.dataset.value);
                        star.style.fill = starValue <= rating ? 'var(--star-color)' : 'none';
                        star.style.color = starValue <= rating ? 'var(--star-color)' : 'currentColor';
                    });
                }

                function displayComments() {
                    commentsSection.innerHTML = savedComments.map(comment => `
                        <div class="p-3 rounded-md" style="background-color: var(--card-hover-bg);">
                            <p>${comment.text}</p>
                            <p class="text-xs mt-1" style="color: var(--text-secondary);">${new Date(comment.date).toLocaleString()}</p>
                        </div>
                    `).join('');
                }

                displayStars(savedRating);
                displayComments();

                // Event Listeners
                ratingContainer.addEventListener('click', e => {
                    const star = e.target.closest('i');
                    if (star) {
                        const newRating = star.dataset.value;
                        localStorage.setItem(`rating_${contentId}`, newRating);
                        displayStars(newRating);
                    }
                });

                commentForm.addEventListener('submit', e => {
                    e.preventDefault();
                    const textarea = e.target.querySelector('textarea');
                    const commentText = textarea.value.trim();
                    if (commentText) {
                        savedComments.unshift({ text: commentText, date: new Date() });
                        localStorage.setItem(`comments_${contentId}`, JSON.stringify(savedComments));
                        displayComments();
                        textarea.value = '';
                    }
                });
            }


            function setupEventListeners() {
                DOMElements.profileBtn.onclick = (e) => { e.stopPropagation(); DOMElements.profileMenu.classList.toggle('hidden'); };
                DOMElements.themeToggle.onclick = toggleTheme;
                DOMElements.hamburgerBtn.onclick = () => DOMElements.mobileNav.classList.add('active');
                DOMElements.closeMobileNav.onclick = () => DOMElements.mobileNav.classList.remove('active');
                
                DOMElements.mobileProfileBtn.onclick = () => DOMElements.mobileProfileOverlay.classList.add('active');
                DOMElements.closeProfileOverlay.onclick = () => DOMElements.mobileProfileOverlay.classList.remove('active');
                DOMElements.mobileThemeToggle.onclick = toggleTheme;
                
                // Navegação Principal
                DOMElements.homeLink.onclick = (e) => { e.preventDefault(); renderHomePage(); };
                DOMElements.desktopListBtn.onclick = renderMyListPage;
                DOMElements.desktopMoviesBtn.onclick = () => renderCategoryPage('Filmes', db.movies, { title: 'Nenhum filme encontrado', subtitle: 'Não há filmes para exibir no momento.' }, createGridMovieCardHTML);
                DOMElements.desktopSeriesBtn.onclick = () => renderCategoryPage('Séries', db.series, { title: 'Nenhuma série encontrada', subtitle: 'Volte mais tarde!' }, createSeriesCardHTML);

                // --- Event Listeners de Busca ---
                const openSearch = () => DOMElements.searchModal.container.classList.add('active');
                DOMElements.desktopSearchBtn.onclick = openSearch;
                DOMElements.mobileNavBar.querySelector('[data-nav="search"]').onclick = openSearch;
                DOMElements.searchModal.closeBtn.onclick = () => DOMElements.searchModal.container.classList.remove('active');
                DOMElements.searchModal.input.addEventListener('input', performSearch);


                // Navegação da Barra Inferior (Mobile)
                DOMElements.mobileNavBar.addEventListener('click', (e) => {
                    const navBtn = e.target.closest('.mobile-nav-item');
                    if (!navBtn || !navBtn.dataset.nav) return;
                    if (navBtn.dataset.nav === 'home') renderHomePage();
                    if (navBtn.dataset.nav === 'list') renderMyListPage();
                });

                // Navegação do Menu Lateral (Mobile)
                document.getElementById('mobile-sidebar-nav').addEventListener('click', (e) => {
                    e.preventDefault();
                    const navLink = e.target.closest('a');
                    if (!navLink || !navLink.dataset.nav) return;
                    const navTarget = navLink.dataset.nav;
                    switch(navTarget) {
                        case 'home': renderHomePage(); break;
                        case 'movies': renderCategoryPage('Filmes', db.movies, { title: 'Nenhum filme encontrado', subtitle: 'Não há filmes para exibir no momento.' }, createGridMovieCardHTML); break;
                        case 'series': renderCategoryPage('Séries', db.series, { title: 'Nenhuma série encontrada', subtitle: 'Volte mais tarde!' }, createSeriesCardHTML); break;
                    }
                    DOMElements.mobileNav.classList.remove('active');
                });

                // Listener de cliques global
                document.addEventListener('click', (e) => {
                    const target = e.target;
                    const detailsBtn = target.closest('.details-btn');
                    if (detailsBtn) {
                        DOMElements.searchModal.container.classList.remove('active');
                        return showDetailsModal(detailsBtn.dataset.movieId);
                    }

                    const watchBtn = target.closest('.watch-btn');
                    if (watchBtn) return openPlayerModal(watchBtn.dataset.movieId);
                    
                    const listBtn = target.closest('.add-to-list-btn');
                    if (listBtn) return toggleMovieInList(listBtn.dataset.movieId);
                    
                    const seriesCard = target.closest('.series-card');
                    if (seriesCard) {
                         DOMElements.searchModal.container.classList.remove('active');
                        return renderSeriesDetailsPage(seriesCard.dataset.seriesId);
                    }

                    const episodeItem = target.closest('.episode-item');
                    if (episodeItem) return openPlayerModalForEpisode(episodeItem.dataset.videoUrl, episodeItem.dataset.videoTitle);

                    if (!DOMElements.profileDropdownContainer.contains(target)) {
                        DOMElements.profileMenu.classList.add('hidden');
                    }
                });

                DOMElements.playerModal.closeBtn.onclick = closePlayerModal;
            }
            
            function init() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') DOMElements.html.classList.replace('dark', 'light');
                
                renderHomePage();
                setupEventListeners();
                updateThemeIcons();
                lucide.createIcons();
                DOMElements.loadingSpinner.style.display = 'none';
            }

            init();
        });
    </script>
</body>
</html>
